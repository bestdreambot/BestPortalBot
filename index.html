<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>BestPortal — Mini App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <style>
    :root { --app-height: 100vh; }

    html, body {
      margin: 0;
      padding: 0;
      height: var(--app-height);
      background: #000;
      overflow: hidden;
      touch-action: manipulation;
    }

    .screen {
      display: none;
      width: 100%;
      height: 100%;
      position: relative;
    }
    .screen.active { display: block; }

    .center {
      position: absolute;
      inset: 0;
      display: grid;
      place-items: center;
    }

    #logo {
      max-width: 92vw;
      max-height: 92vh;
      display: block;
      user-select: none;
      -webkit-user-drag: none;
      cursor: pointer;
    }

    .hidden { display: none !important; }

    /* скрытый отладчик (оставлен на случай проблем) */
    #debug { display:none; position:fixed; left:8px; bottom:8px; color:#7a7a7a; font:12px/1.3 monospace; }
  </style>
</head>
<body>
  <!-- Экран логотипа -->
  <section id="s-logo" class="screen active">
    <div class="center">
      <img id="logo" alt="BestPortal">
    </div>
  </section>

  <!-- Экран портала (чёрный фон) -->
  <section id="s-portal" class="screen">
    <div class="center" aria-live="polite" style="color:#fff;font:16px system-ui,sans-serif">
      Вход в портал…
    </div>
  </section>

  <div id="debug"></div>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script>
    (function () {
      const dbgEl = document.getElementById('debug');
      const dbg = (m) => { dbgEl.textContent = m || ''; };

      // ----- Telegram API -----
      const tg = window.Telegram && Telegram.WebApp ? Telegram.WebApp : null;

      function applyHeight() {
        const h = tg && tg.viewportHeight ? tg.viewportHeight : window.innerHeight;
        document.documentElement.style.setProperty('--app-height', h + 'px');
      }

      try {
        if (tg) {
          tg.ready();
          tg.setBackgroundColor('#000000');
          tg.setHeaderColor('bg_color');
          tg.expand();
          applyHeight();
          tg.onEvent('viewportChanged', applyHeight);
          // доп. вызов для iOS/проблемных клиентов
          setTimeout(() => tg.expand(), 120);
        } else {
          applyHeight();
          window.addEventListener('resize', applyHeight);
        }
      } catch (e) { /* no-op */ }

      // ----- Загрузка логотипа с учётом пути и кэша -----
      const ver = Date.now();
      // Жёстко фиксируем корень проекта, чтобы Telegram-кэш не ломал относительные пути
      const ROOT = '/BestPortalBot/';
      const candidates = [
        ROOT + 'img/logo.png?v=' + ver,
        ROOT + 'img/bestportal.png?v=' + ver,
        ROOT + 'img/bestportal.jpeg?v=' + ver,
        'img/logo.png?v=' + ver,
        'img/bestportal.png?v=' + ver,
        'img/bestportal.jpeg?v=' + ver
      ];

      const logo = document.getElementById('logo');
      function tryLoad(list) {
        if (!list.length) { dbg('Лого не найдено по всем путям'); return; }
        const url = list.shift();
        logo.onload = () => { dbg(''); };
        logo.onerror = () => { dbg('Ошибка загрузки: ' + url); tryLoad(list); };
        logo.src = url;
      }
      tryLoad(candidates.slice());

      // ----- Переход в портал (прячем картинку) -----
      const sLogo = document.getElementById('s-logo');
      const sPortal = document.getElementById('s-portal');
      function enterPortal() {
        sLogo.classList.remove('active');
        sPortal.classList.add('active');
        if (tg) tg.expand(); // удерживаем полноэкранный режим
      }
      logo.addEventListener('click', enterPortal, { passive: true });
      logo.addEventListener('touchend', enterPortal, { passive: true });

      // Дополнительно — повторно убедимся в полноэкранности после полной загрузки
      window.addEventListener('load', () => { if (tg) tg.expand(); }, { once: true });
    })();
  </script>
</body>
</html>
